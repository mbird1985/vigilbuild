{% extends "base.html" %}
{% block title %}{{ template.name }} - Checklist Template{% endblock %}
{% block content %}
<div class="container mx-auto px-4 py-6">
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl font-bold text-gray-800">{{ template.name }}</h1>
            <p class="text-gray-600">Checklist Template</p>
        </div>
        <div class="flex gap-3">
            <a href="{{ url_for('equipment.maintenance_checklist_edit', template_id=template.id) }}"
               class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Edit Template</a>
            <a href="{{ url_for('equipment.maintenance_checklists') }}" class="text-gray-600 hover:text-gray-800">&larr; Back</a>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Template Info -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold mb-4">Template Details</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                    <div>
                        <span class="text-sm text-gray-500">Equipment Type</span>
                        <p class="font-medium">{{ template.equipment_type or 'All Types' }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Total Items</span>
                        <p class="font-medium">{{ template.items|length }}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Status</span>
                        <p>
                            {% if template.is_active %}
                            <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Active</span>
                            {% else %}
                            <span class="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800">Inactive</span>
                            {% endif %}
                        </p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Created</span>
                        <p class="font-medium">{{ template.created_at.strftime('%Y-%m-%d') if template.created_at else '-' }}</p>
                    </div>
                </div>
                {% if template.description %}
                <div>
                    <span class="text-sm text-gray-500">Description</span>
                    <p class="mt-1">{{ template.description }}</p>
                </div>
                {% endif %}
            </div>

            <!-- Checklist Items by Category -->
            {% set items_by_category = {} %}
            {% for item in template.items %}
                {% set cat = item.category or 'General' %}
                {% if cat not in items_by_category %}
                    {% set _ = items_by_category.update({cat: []}) %}
                {% endif %}
                {% set _ = items_by_category[cat].append(item) %}
            {% endfor %}

            {% for category, items in items_by_category.items() %}
            <div class="bg-white rounded-lg shadow">
                <div class="p-4 border-b bg-gray-50">
                    <h2 class="font-semibold">{{ category }}</h2>
                    <p class="text-sm text-gray-500">{{ items|length }} items</p>
                </div>
                <div class="divide-y">
                    {% for item in items %}
                    <div class="p-4">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center gap-2">
                                    <span class="w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-xs text-gray-600">{{ loop.index }}</span>
                                    <span class="font-medium">{{ item.label }}</span>
                                    {% if item.is_required %}
                                    <span class="text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded">Required</span>
                                    {% endif %}
                                    {% if item.requires_photo %}
                                    <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded">Photo Required</span>
                                    {% endif %}
                                </div>
                                {% if item.description %}
                                <p class="text-sm text-gray-600 mt-1 ml-8">{{ item.description }}</p>
                                {% endif %}
                            </div>
                            <div class="text-sm text-gray-500">
                                Order: {{ item.sort_order }}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div class="bg-white rounded-lg shadow p-8 text-center text-gray-500">
                No checklist items defined yet.
                <a href="{{ url_for('equipment.maintenance_checklist_edit', template_id=template.id) }}"
                   class="text-blue-600 hover:underline ml-1">Add items</a>
            </div>
            {% endfor %}
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-1 space-y-6">
            <!-- Quick Actions -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="font-semibold mb-4">Actions</h3>
                <div class="space-y-2">
                    <a href="{{ url_for('equipment.maintenance_inspection_new') }}?template_id={{ template.id }}"
                       class="block w-full text-center px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                        Start Inspection with Template
                    </a>
                    <a href="{{ url_for('equipment.maintenance_checklist_edit', template_id=template.id) }}"
                       class="block w-full text-center px-4 py-2 border border-gray-300 rounded hover:bg-gray-50">
                        Edit Template
                    </a>
                    <a href="{{ url_for('equipment.maintenance_checklist_duplicate', template_id=template.id) }}"
                       class="block w-full text-center px-4 py-2 border border-gray-300 rounded hover:bg-gray-50">
                        Duplicate Template
                    </a>
                </div>
            </div>

            <!-- Usage Statistics -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="font-semibold mb-4">Usage Statistics</h3>
                <dl class="space-y-3 text-sm">
                    <div class="flex justify-between">
                        <dt class="text-gray-500">Total Inspections</dt>
                        <dd class="font-medium">{{ usage_stats.total_inspections or 0 }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-500">This Month</dt>
                        <dd class="font-medium">{{ usage_stats.this_month or 0 }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-500">Pass Rate</dt>
                        <dd class="font-medium text-green-600">{{ usage_stats.pass_rate or 0 }}%</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-500">Avg. Completion Time</dt>
                        <dd class="font-medium">{{ usage_stats.avg_time or '-' }}</dd>
                    </div>
                </dl>
            </div>

            <!-- Item Summary -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="font-semibold mb-4">Item Summary</h3>
                <div class="space-y-2 text-sm">
                    {% set required_count = template.items|selectattr('is_required')|list|length %}
                    {% set photo_count = template.items|selectattr('requires_photo')|list|length %}
                    <div class="flex justify-between">
                        <span class="text-gray-500">Total Items</span>
                        <span class="font-medium">{{ template.items|length }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-500">Required Items</span>
                        <span class="font-medium text-red-600">{{ required_count }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-500">Photo Required</span>
                        <span class="font-medium text-yellow-600">{{ photo_count }}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-500">Categories</span>
                        <span class="font-medium">{{ items_by_category|length }}</span>
                    </div>
                </div>
            </div>

            <!-- Print Preview -->
            <div class="bg-blue-50 rounded-lg p-4">
                <h3 class="font-semibold text-blue-800 mb-2">Print Version</h3>
                <p class="text-sm text-blue-700 mb-3">Download a printable version for offline use.</p>
                <a href="{{ url_for('equipment.maintenance_checklist_pdf', template_id=template.id) }}"
                   class="inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">
                    Download PDF
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
