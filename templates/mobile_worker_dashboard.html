{% extends "mobile_base.html" %}
{% block title %}My Work - Maintenance{% endblock %}
{% block header_title %}My Work{% endblock %}

{% block header_right %}
<button onclick="location.reload()" class="p-2 touch-btn">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
    </svg>
</button>
{% endblock %}

{% block content %}
<div class="p-4 space-y-4">
    <!-- Today's Summary -->
    <div class="bg-white rounded-xl shadow-sm p-4">
        <h2 class="text-sm font-medium text-gray-500 uppercase mb-3">Today's Summary</h2>
        <div class="grid grid-cols-3 gap-4 text-center">
            <div>
                <div class="text-2xl font-bold text-blue-600">{{ stats.assigned }}</div>
                <div class="text-xs text-gray-500">Assigned</div>
            </div>
            <div>
                <div class="text-2xl font-bold text-yellow-600">{{ stats.in_progress }}</div>
                <div class="text-xs text-gray-500">In Progress</div>
            </div>
            <div>
                <div class="text-2xl font-bold text-green-600">{{ stats.completed_today }}</div>
                <div class="text-xs text-gray-500">Completed</div>
            </div>
        </div>
    </div>

    <!-- Active Job (if any) -->
    {% if active_job %}
    <div class="bg-yellow-50 border-l-4 border-yellow-500 rounded-xl shadow-sm p-4">
        <div class="flex items-center justify-between mb-2">
            <span class="text-xs font-medium text-yellow-700 uppercase">Currently Working</span>
            <span class="text-xs text-yellow-600">{{ active_job.started_at.strftime('%H:%M') if active_job.started_at else '' }}</span>
        </div>
        <h3 class="font-semibold text-lg">{{ active_job.equipment_unique_id }}</h3>
        <p class="text-gray-600 text-sm">{{ active_job.job_type|capitalize }} - {{ active_job.description[:50] if active_job.description else 'No description' }}...</p>
        <div class="mt-3 flex gap-2">
            <a href="{{ url_for('mobile.worker_job_detail', job_id=active_job.id) }}"
               class="flex-1 bg-yellow-500 text-white text-center py-3 rounded-lg font-medium touch-btn">
                Continue
            </a>
            <button onclick="showCompleteJobSheet({{ active_job.id }})"
                    class="flex-1 bg-green-600 text-white text-center py-3 rounded-lg font-medium touch-btn">
                Complete
            </button>
        </div>
    </div>
    {% endif %}

    <!-- Assigned Jobs -->
    <div>
        <h2 class="text-sm font-medium text-gray-500 uppercase mb-3">Assigned Jobs</h2>
        <div class="space-y-3">
            {% for job in assigned_jobs %}
            <div class="bg-white rounded-xl shadow-sm p-4 swipe-card" onclick="location.href='{{ url_for('mobile.worker_job_detail', job_id=job.id) }}'">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <h3 class="font-semibold">{{ job.equipment_unique_id }}</h3>
                            {% if job.priority == 'high' or job.priority == 'critical' %}
                            <span class="px-2 py-0.5 text-xs rounded-full bg-red-100 text-red-800">{{ job.priority|upper }}</span>
                            {% endif %}
                        </div>
                        <p class="text-sm text-gray-600 capitalize">{{ job.job_type }}</p>
                        <p class="text-xs text-gray-500 mt-1">{{ job.equipment_location or 'Location not specified' }}</p>
                    </div>
                    <div class="text-right">
                        {% if job.due_date %}
                        <span class="text-xs {% if job.is_overdue %}text-red-600{% else %}text-gray-500{% endif %}">
                            Due: {{ job.due_date.strftime('%m/%d') }}
                        </span>
                        {% endif %}
                        <svg class="w-5 h-5 text-gray-400 mt-2 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="bg-white rounded-xl shadow-sm p-8 text-center text-gray-500">
                <svg class="w-12 h-12 mx-auto text-gray-300 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <p>No jobs assigned</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-2 gap-3">
        <a href="{{ url_for('mobile.worker_start_inspection') }}"
           class="bg-white rounded-xl shadow-sm p-4 text-center touch-btn flex flex-col items-center justify-center">
            <svg class="w-8 h-8 text-blue-600 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
            </svg>
            <span class="text-sm font-medium">Start Inspection</span>
        </a>
        <a href="{{ url_for('mobile.worker_log_time') }}"
           class="bg-white rounded-xl shadow-sm p-4 text-center touch-btn flex flex-col items-center justify-center">
            <svg class="w-8 h-8 text-green-600 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span class="text-sm font-medium">Log Time</span>
        </a>
        <a href="{{ url_for('mobile.worker_scan_equipment') }}"
           class="bg-white rounded-xl shadow-sm p-4 text-center touch-btn flex flex-col items-center justify-center">
            <svg class="w-8 h-8 text-purple-600 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/>
            </svg>
            <span class="text-sm font-medium">Scan QR/Barcode</span>
        </a>
        <a href="{{ url_for('mobile.worker_report_issue') }}"
           class="bg-white rounded-xl shadow-sm p-4 text-center touch-btn flex flex-col items-center justify-center">
            <svg class="w-8 h-8 text-red-600 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
            <span class="text-sm font-medium">Report Issue</span>
        </a>
    </div>
</div>
{% endblock %}

{% block nav %}
<nav class="mobile-nav bg-white border-t flex justify-around py-2">
    <a href="{{ url_for('mobile.worker_dashboard') }}" class="flex flex-col items-center p-2 text-blue-600">
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
        </svg>
        <span class="text-xs mt-1">Home</span>
    </a>
    <a href="{{ url_for('mobile.worker_jobs') }}" class="flex flex-col items-center p-2 text-gray-500">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
        </svg>
        <span class="text-xs mt-1">Jobs</span>
    </a>
    <a href="{{ url_for('mobile.worker_history') }}" class="flex flex-col items-center p-2 text-gray-500">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <span class="text-xs mt-1">History</span>
    </a>
    <a href="{{ url_for('mobile.worker_profile') }}" class="flex flex-col items-center p-2 text-gray-500">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
        </svg>
        <span class="text-xs mt-1">Profile</span>
    </a>
</nav>
{% endblock %}

{% block scripts %}
<script>
function showCompleteJobSheet(jobId) {
    const content = `
        <h3 class="font-semibold text-lg mb-4">Complete Job</h3>
        <form method="POST" action="/mobile/worker/job/${jobId}/complete">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Completion Notes</label>
                    <textarea name="notes" rows="3" class="w-full border border-gray-300 rounded-lg p-3" placeholder="What was done?"></textarea>
                </div>
                <div class="flex gap-3">
                    <button type="button" onclick="closeActionSheet()" class="flex-1 py-3 border border-gray-300 rounded-lg font-medium">Cancel</button>
                    <button type="submit" class="flex-1 py-3 bg-green-600 text-white rounded-lg font-medium">Complete</button>
                </div>
            </div>
        </form>
    `;
    showActionSheet(content);
}
</script>
{% endblock %}
