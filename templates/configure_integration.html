<!-- templates/configure_integration.html -->
{% extends "base.html" %}
{% block content %}
<div class="space-y-6">
  <div class="flex items-center justify-between">
    <div class="flex items-center space-x-4">
      <!-- System Icon -->
      {% if system == 'outlook' %}
        <svg class="w-12 h-12 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
          <path d="M7.88 12.04q0 .45-.11.87-.1.41-.33.74-.22.33-.58.52-.37.2-.87.2t-.85-.2q-.35-.21-.57-.55-.22-.33-.33-.75-.1-.42-.1-.83 0-.42.1-.84.11-.41.33-.73.22-.32.57-.52.35-.19.85-.19t.87.19q.36.2.58.52.22.32.33.73.11.42.11.84zM24 12v9.38q0 .46-.33.8-.33.32-.8.32H7.13q-.46 0-.8-.33-.32-.33-.32-.8V18H1q-.41 0-.7-.3-.3-.29-.3-.7V7q0-.41.3-.7Q.58 6 1 6h6.5L9 4.4q.18-.3.5-.3H23q.41 0 .7.3.3.29.3.7v7zm-6.38-9.25q-.34-.4-.85-.4h-2.07q-.38 0-.65.27-.26.26-.26.65v8.96q0 .39.26.65.27.27.65.27h2.07q.51 0 .85-.4.34-.4.34-.9V3.65q0-.5-.34-.9z"/>
        </svg>
      {% elif system == 'powerbi' %}
        <svg class="w-12 h-12 text-yellow-600" fill="currentColor" viewBox="0 0 24 24">
          <path d="M14.25 2.1l-.4.2c-.2.1-.3.3-.3.5v18.4c0 .2.1.4.3.5l.4.2c1.5.7 3.2-.1 3.2-1.7V3.8c0-1.6-1.7-2.4-3.2-1.7zM11 5.9l-.4.2c-.2.1-.3.3-.3.5v11.8c0 .2.1.4.3.5l.4.2c1.5.7 3.2-.1 3.2-1.7V7.6c0-1.6-1.7-2.4-3.2-1.7zM7.75 9.7l-.4.2c-.2.1-.3.3-.3.5v7.2c0 .2.1.4.3.5l.4.2c1.5.7 3.2-.1 3.2-1.7v-5.2c0-1.6-1.7-2.4-3.2-1.7zM4.5 13.5l-.4.2c-.2.1-.3.3-.3.5v3.6c0 .2.1.4.3.5l.4.2c1.5.7 3.2-.1 3.2-1.7v-1.6c0-1.6-1.7-2.4-3.2-1.7z"/>
        </svg>
      {% elif system == 'salesforce' %}
        <svg class="w-12 h-12 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12.5 2.1c-2.8 0-5.2 1.9-6 4.5-1.1-.6-2.4-.9-3.7-.9C1.2 5.7 0 6.9 0 8.4c0 1.5 1.2 2.7 2.8 2.7h16.4c2.2 0 4-1.8 4-4s-1.8-4-4-4c-.4 0-.8.1-1.2.2-1.1-2.6-3.7-4.2-5.5-1.2zm-5.3 9.6c-1.9 0-3.5 1.6-3.5 3.5s1.6 3.5 3.5 3.5h10.6c1.9 0 3.5-1.6 3.5-3.5s-1.6-3.5-3.5-3.5H7.2z"/>
        </svg>
      {% else %}
        <svg class="w-12 h-12 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
      {% endif %}
      
      <div>
        <h2 class="text-2xl font-semibold text-teal-800">{{ system_name }}</h2>
        <p class="text-gray-600">Configure API integration settings</p>
      </div>
    </div>
    <a href="{{ url_for('integration.integrate') }}" class="text-teal-600 hover:text-teal-800 flex items-center">
      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      Back to Integrations
    </a>
  </div>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="bg-orange-100 border border-orange-400 text-orange-700 px-4 py-3 rounded">
        {{ messages[0] }}
      </div>
    {% endif %}
  {% endwith %}

  <div class="bg-white rounded-lg shadow-md max-w-4xl mx-auto">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900">Configuration Settings</h3>
    </div>

    <!-- Configuration Form -->
    <form method="POST" class="p-6">
      <input type="hidden" name="system_type" value="{{ system }}">
      
      <div class="space-y-6">
        {% if system == 'outlook' %}
          <!-- Outlook Configuration Fields -->
          <div class="grid grid-cols-1 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Application (Client) ID</label>
              <input type="text" name="client_id" 
                     value="{{ existing_config.client_id if existing_config else '' }}" 
                     required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                     placeholder="e.g., 12345678-1234-1234-1234-123456789012">
              <p class="mt-1 text-sm text-gray-600">
                <strong>Where to find:</strong> Azure Portal → App registrations → Your app → Overview → Application (client) ID
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Client Secret</label>
              <input type="password" name="client_secret" required 
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                     placeholder="Enter client secret">
              <p class="mt-1 text-sm text-gray-600">
                <strong>Where to find:</strong> Azure Portal → App registrations → Your app → Certificates & secrets → New client secret
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Tenant ID (Optional)</label>
              <input type="text" name="tenant_id" 
                     value="{{ existing_config.tenant_id if existing_config else '' }}" 
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                     placeholder="e.g., 87654321-4321-4321-4321-210987654321">
              <p class="mt-1 text-sm text-gray-600">
                <strong>Where to find:</strong> Azure Portal → Azure Active Directory → Overview → Tenant ID. Leave blank for multi-tenant apps.
              </p>
            </div>
          </div>

        {% elif system == 'powerbi' %}
          <!-- Power BI Configuration Fields -->
          <div class="grid grid-cols-1 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Application ID</label>
              <input type="text" name="client_id" 
                     value="{{ existing_config.client_id if existing_config else '' }}" 
                     required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                     placeholder="e.g., 12345678-1234-1234-1234-123456789012">
              <p class="mt-1 text-sm text-gray-600">
                <strong>Where to find:</strong> Azure Portal → App registrations → Your Power BI app → Overview → Application ID
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Application Secret</label>
              <input type="password" name="client_secret" required 
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                     placeholder="Enter application secret">
              <p class="mt-1 text-sm text-gray-600">
                <strong>Where to find:</strong> Azure Portal → App registrations → Your Power BI app → Certificates & secrets
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Workspace ID</label>
              <input type="text" name="workspace_id" 
                     value="{{ existing_config.workspace_id if existing_config else '' }}" 
                     required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                     placeholder="e.g., 12345678-1234-1234-1234-123456789012">
              <p class="mt-1 text-sm text-gray-600">
                <strong>Where to find:</strong> Power BI Service → Your workspace → Settings → Copy the workspace ID from the URL or workspace settings
              </p>
            </div>
          </div>

        {% elif system == 'salesforce' %}
          <!-- Salesforce Configuration Fields -->
          <div class="grid grid-cols-1 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Instance URL</label>
              <input type="url" name="instance_url" 
                     value="{{ existing_config.instance_url if existing_config else '' }}" 
                     required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                     placeholder="https://yourinstance.salesforce.com">
              <p class="mt-1 text-sm text-gray-600">
                <strong>Where to find:</strong> Your Salesforce login URL (e.g., https://yourcompany.salesforce.com or https://yourcompany.my.salesforce.com)
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Consumer Key</label>
              <input type="text" name="client_id" 
                     value="{{ existing_config.client_id if existing_config else '' }}" 
                     required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                     placeholder="Enter consumer key">
              <p class="mt-1 text-sm text-gray-600">
                <strong>Where to find:</strong> Salesforce Setup → Apps → App Manager → Your Connected App → View → Consumer Key
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Consumer Secret</label>
              <input type="password" name="client_secret" required 
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                     placeholder="Enter consumer secret">
              <p class="mt-1 text-sm text-gray-600">
                <strong>Where to find:</strong> Salesforce Setup → Apps → App Manager → Your Connected App → View → Consumer Secret (click to reveal)
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
              <input type="email" name="username" 
                     value="{{ existing_config.username if existing_config else '' }}" 
                     required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                     placeholder="salesforce.user@company.com">
              <p class="mt-1 text-sm text-gray-600">
                <strong>Description:</strong> Your Salesforce username (usually your email address)
              </p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Password + Security Token</label>
              <input type="password" name="password" required 
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                     placeholder="passwordSECURITYTOKEN">
              <p class="mt-1 text-sm text-gray-600">
                <strong>How to create:</strong> Concatenate your Salesforce password with your security token. Get security token from: Salesforce → Settings → Reset My Security Token
              </p>
            </div>
          </div>

        {% elif system == 'gps' %}
          <!-- GPS/Telematics Configuration Fields -->
          <div class="grid grid-cols-1 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Provider Name</label>
              <input type="text" name="system_name" value="{{ existing_config.system_name if existing_config else '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="e.g., Samsara, Geotab, VisionLink">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">API Base URL</label>
              <input type="url" name="api_url" value="{{ existing_config.api_url if existing_config else '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="https://api.provider.com">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Authentication Type</label>
              <select name="auth_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                <option value="api_key">API Key</option>
                <option value="oauth2">OAuth 2.0</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">API Key / Client Credentials</label>
              <input type="text" name="api_key" value="{{ existing_config.api_key if existing_config else '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="key or client_id:client_secret">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Webhook URL (optional)</label>
              <input type="url" name="webhook_url" value="{{ existing_config.webhook_url if existing_config else '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="https://yourapp/webhooks/gps">
            </div>
          </div>
        {% else %}
          <!-- Custom System Configuration Fields -->
          <div class="grid grid-cols-1 gap-6">
            <input type="hidden" name="existing_name" value="{{ existing_name or '' }}">

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">System Name</label>
              <input type="text" name="system_name"
                     value="{{ existing_config.system_name if existing_config else '' }}"
                     required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                     placeholder="e.g., Samsara, Geotab, SupplierXYZ">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Connection Type</label>
              <select name="connection_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                {% set ct = existing_config.connection_type if existing_config else 'api' %}
                <option value="api" {{ 'selected' if ct == 'api' else '' }}>API (Key/Bearer/Basic)</option>
                <option value="oauth2" {{ 'selected' if ct == 'oauth2' else '' }}>OAuth 2.0</option>
                <option value="webhook" {{ 'selected' if ct == 'webhook' else '' }}>Webhook</option>
                <option value="other" {{ 'selected' if ct == 'other' else '' }}>Other</option>
              </select>
            </div>

            <!-- API Section -->
            <div class="space-y-4 border rounded-md p-4" x-data="{show: '{{ ct }}' === 'api'}" x-show="show" style="display: {{ 'block' if ct == 'api' else 'none' }};">
              <div class="text-sm font-semibold text-gray-700">API Settings</div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">API Base URL</label>
                <input type="url" name="api_url" value="{{ existing_config.api_url if existing_config else '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="https://api.example.com/v1">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Authentication</label>
                <select name="auth_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                  {% set at = existing_config.auth_type if existing_config else '' %}
                  <option value="">None</option>
                  <option value="api_key" {{ 'selected' if at == 'api_key' else '' }}>API Key</option>
                  <option value="bearer_token" {{ 'selected' if at == 'bearer_token' else '' }}>Bearer Token</option>
                  <option value="basic_auth" {{ 'selected' if at == 'basic_auth' else '' }}>Basic Auth</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">API Key / Token / Credentials</label>
                <input type="password" name="api_key" value="{{ existing_config.api_key if existing_config else '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="key or username:password for Basic">
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">API Key Header</label>
                  <input type="text" name="api_key_header" value="{{ existing_config.api_key_header if existing_config else 'X-API-Key' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Extra Headers (JSON)</label>
                  <input type="text" name="extra_headers" value="{{ existing_config.extra_headers if existing_config else '{}' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder='{ "Accept": "application/json" }'>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Extra Query Params (JSON)</label>
                <input type="text" name="extra_params" value="{{ existing_config.extra_params if existing_config else '{}' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder='{ "limit": 100 }'>
              </div>
            </div>

            <!-- OAuth2 Section -->
            <div class="space-y-4 border rounded-md p-4" x-data="{show: '{{ ct }}' === 'oauth2'}" x-show="show" style="display: {{ 'block' if ct == 'oauth2' else 'none' }};">
              <div class="text-sm font-semibold text-gray-700">OAuth 2.0 Settings</div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Auth URL</label>
                  <input type="url" name="auth_url" value="{{ existing_config.auth_url if existing_config else '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Token URL</label>
                  <input type="url" name="token_url" value="{{ existing_config.token_url if existing_config else '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Client ID</label>
                  <input type="text" name="client_id" value="{{ existing_config.client_id if existing_config else '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Client Secret</label>
                  <input type="password" name="client_secret" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Scope</label>
                  <input type="text" name="scope" value="{{ existing_config.scope if existing_config else '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="space-separated scopes">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Redirect URI</label>
                  <input type="url" name="redirect_uri" value="{{ existing_config.redirect_uri if existing_config else '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="https://app.example.com/oauth/callback">
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Grant Type</label>
                <select name="grant_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                  {% set gt = existing_config.grant_type if existing_config else 'client_credentials' %}
                  <option value="client_credentials" {{ 'selected' if gt == 'client_credentials' else '' }}>Client Credentials</option>
                  <option value="authorization_code" {{ 'selected' if gt == 'authorization_code' else '' }}>Authorization Code</option>
                </select>
              </div>
            </div>

            <!-- Webhook Section -->
            <div class="space-y-4 border rounded-md p-4" x-data="{show: '{{ ct }}' === 'webhook'}" x-show="show" style="display: {{ 'block' if ct == 'webhook' else 'none' }};">
              <div class="text-sm font-semibold text-gray-700">Webhook Settings</div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Webhook URL</label>
                <input type="url" name="webhook_url" value="{{ existing_config.webhook_url if existing_config else '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="https://app.example.com/webhooks/vendor">
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Signing Secret</label>
                  <input type="password" name="webhook_secret" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Signature Header</label>
                  <input type="text" name="signature_header" value="{{ existing_config.signature_header if existing_config else 'X-Signature' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Verify Token</label>
                  <input type="text" name="verify_token" value="{{ existing_config.verify_token if existing_config else '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Events (CSV)</label>
                  <input type="text" name="events" value="{{ existing_config.events if existing_config else '' }}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="asset.update,trip.create">
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">HTTP Method</label>
                <select name="method" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent">
                  {% set wm = existing_config.method if existing_config else 'POST' %}
                  <option value="POST" {{ 'selected' if wm == 'POST' else '' }}>POST</option>
                  <option value="GET" {{ 'selected' if wm == 'GET' else '' }}>GET</option>
                </select>
              </div>
            </div>

            <!-- Other Section -->
            <div class="space-y-4 border rounded-md p-4" x-data="{show: '{{ ct }}' === 'other'}" x-show="show" style="display: {{ 'block' if ct == 'other' else 'none' }};">
              <div class="text-sm font-semibold text-gray-700">Other Connection</div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                <textarea name="notes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="Document connection details here.">{{ existing_config.notes if existing_config else '' }}</textarea>
              </div>
            </div>
          </div>
        {% endif %}

        <!-- Common Description Field -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Description (Optional)</label>
          <textarea name="description" rows="3" 
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
                    placeholder="Describe this integration and its purpose">{{ existing_config.description if existing_config else '' }}</textarea>
          <p class="mt-1 text-sm text-gray-600">
            <strong>Description:</strong> Optional notes about what this integration is used for
          </p>
        </div>

        <!-- Enable/Disable Toggle -->
        <div class="flex items-center">
          <input type="checkbox" name="enabled" id="enabled" 
                 {{ 'checked' if not existing_config or existing_config.enabled else '' }} 
                 class="h-4 w-4 text-teal-600 focus:ring-teal-500 border-gray-300 rounded">
          <label for="enabled" class="ml-2 block text-sm text-gray-900">
            Enable this integration
          </label>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="mt-8 pt-6 border-t border-gray-200">
        <div class="flex flex-wrap gap-3">
          {% if existing_config %}
            <button type="submit" name="action" value="update" 
                    class="btn-integration btn-orange btn-form">
              Update Integration
            </button>
            <button type="submit" name="action" value="test" 
                    class="btn-integration btn-blue btn-form">
              Test Connection
            </button>
            <button type="submit" name="action" value="delete" 
                    class="btn-integration btn-red btn-form"
                    onclick="return confirm('Are you sure you want to delete this integration? This action cannot be undone.')">
              Delete Integration
            </button>
          {% else %}
            <button type="submit" name="action" value="create" 
                    class="btn-integration btn-teal btn-form">
              Create Integration
            </button>
            <button type="submit" name="action" value="test" 
                    class="btn-integration btn-blue btn-form">
              Test Connection
            </button>
          {% endif %}
        </div>
      </div>
    </form>
  </div>
</div>
{% endblock %}